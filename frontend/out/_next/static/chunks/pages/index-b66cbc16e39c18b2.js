(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5728:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(1062)}])},1062:function(e,t,n){"use strict";n.r(t),n.d(t,{GameStateContext:function(){return g},ShowLoginContext:function(){return p},default:function(){return v}});var o=n(5893),s=n(7294),a=n(8884),i=n.n(a),r=function(){let e;let[{gameInProgress:t}]=(0,s.useContext)(g),[,n]=(0,s.useContext)(p);return(0,o.jsxs)("div",{className:i().sidebar,children:[(0,o.jsx)("h1",{className:i().h1,children:"hoodwinked"}),(0,o.jsx)("h3",{className:i().h3,children:"a game of lies and deceit"}),(0,o.jsx)("div",{className:i().play,children:(e="",e=t?"new game":"start game",(0,o.jsx)("div",{children:(0,o.jsx)("p",{className:i().option,onClick:()=>n(!0),children:e})}))}),(0,o.jsxs)("div",{className:i().info,children:[(0,o.jsx)("p",{className:i().option,children:"about"}),(0,o.jsx)("p",{className:i().option,children:(0,o.jsx)("a",{href:"https://github.com/aogara-ds/hoodwinked",children:"github"})}),(0,o.jsx)("p",{className:i().option,children:"contact"})]})]})},l=n(679),c=n.n(l);async function u(e,t,n){try{let o=await fetch("https://hoodwinked.onrender.com/"+n+"/",{method:"POST",body:JSON.stringify({input:e,game_id:t})});return o}catch(s){console.error(s)}}function d(){let[e,t]=(0,s.useState)(""),[n,a]=(0,s.useState)(!1),i=(0,s.useRef)(null),r=(0,s.useRef)(null),[l,d]=(0,s.useContext)(g),h=(e,t)=>{let n=e.slice(e.indexOf(t)).match(/\d+/g),o=n.map(e=>parseInt(e));return o},x=async()=>{console.log("handleAction");let t=parseInt(e),n=await h(l.history,"Possible Actions:");if(n.includes(t)){console.log("handleAction: valid action"),l.history.match("Possible Actions:[\\s\\S]*?".concat(t,"\\.\\s+(.*?)\\n"))[1];let o=await u(t,l.game_id,l.next_request);if("application/json"==o.headers.get("Content-Type")){console.log("basic response!");let s=await o.json();console.log(s.history),await d({...l,...s}),a(!1)}else f(o,l.history)}else y()},m=async()=>{console.log("handleStatement");let t=l.history.split("\n\n")[-1];var n=l.history.replace(t,e);let o=await u(e,l.game_id,l.next_request);f(o,n)},_=async()=>{console.log("handleVote");let t=parseInt(e),n=await h(l.history,"Who do you vote to banish?"),o=l.history.split("\n\n")[-1];var s=l.history.replace(o,"");if(d({...l,history:s}),n.includes(t)){console.log("handleVote: valid vote"),console.log(l.next_request);let i=l.history.match("Who do you vote to banish?[\\s\\S]*?".concat(t,"\\.\\s+(.*?)\\n"))[1];console.log(t),console.log(i);let r=await u(i,l.game_id,l.next_request),c=await r.json();console.log(await c.history),await d({...l,...c}),a(!1)}},f=async e=>{console.log("handleStream()"),console.log("next_");let t=function(e){let t=e.body.getReader(),n=new AbortController;n.signal;let o=new ReadableStream({start(e){!function n(){t.read().then(t=>{let{done:o,value:s}=t;if(o){e.close();return}e.enqueue(s),n()})}()}});return o[Symbol.asyncIterator]=()=>{let e=o.getReader();return{async next(){let{done:t,value:n}=await e.read();return t?{done:!0}:{done:!1,value:n}},return:async()=>(await e.cancel(),{done:!0})}},o}(e),n=new TextDecoder;var o=l.history;for await(let s of t){let i=n.decode(s);o+="\n\n"+i,d({...l,history:o})}l.next_request.includes("statement")?d({...l,history:o,next_request:"vote"}):l.next_request.includes("action")?d({...l,history:o,next_request:"statement"}):Exception("Invalid next_request"),a(!1)},y=()=>{d({...l,history:l.history+"\n\nSorry, that's not a valid action. Please enter a number from the list above."}),a(!1)},p=n=>{console.log("handleSubmit"),n.preventDefault(),""!==e.trim()&&(t(""),d({...l}),a(!0),console.log("before choosing handler?"),console.log(l.next_request),"action"===l.next_request?x():"statement"===l.next_request?m():"vote"===l.next_request&&_())},w=t=>{"Enter"===t.key&&e?!t.shiftKey&&e&&p(t):"Enter"===t.key&&t.preventDefault()};return(0,s.useEffect)(()=>{let e=i.current;e.scrollTop=e.scrollHeight}),(0,s.useEffect)(()=>{r.current.focus()},[l]),(0,o.jsxs)("div",{className:c().window,children:[(0,o.jsx)("div",{ref:i,className:c().history,children:(()=>{if(l.history){let e=l.history.split("\n").filter(e=>""!==e);return e.map((e,t)=>(0,o.jsx)("p",{children:e},t))}})()}),(0,o.jsxs)("div",{className:c().input,children:[(0,o.jsx)("textarea",{readOnly:n,onKeyDown:w,ref:r,autoFocus:!1,rows:1,maxLength:512,type:"text",id:"userInput",name:"userInput",value:e,onChange:e=>t(e.target.value)}),(0,o.jsx)("button",{type:"submit",onClick:p,disabled:n,children:"send"})]})]})}var h=n(6722),x=n.n(h);function m(e){let[,t]=(0,s.useContext)(p),n=(0,s.useRef)(null);async function a(o){o.preventDefault(),t(!1);let s=n.current.value;await e.startGame(s,!0)}return(0,s.useEffect)(()=>{n.current.focus()},[]),(0,o.jsx)("div",{className:x().loginOverlay,children:(0,o.jsx)("div",{className:x().login,children:(0,o.jsxs)("form",{onSubmit:a,children:[(0,o.jsx)("p",{children:"What is your name?"}),(0,o.jsx)("label",{children:(0,o.jsx)("input",{type:"text",ref:n})}),(0,o.jsx)("button",{type:"submit",children:"submit"})]})})})}var _=n(9008),f=n.n(_);async function y(e,t){try{let n=await fetch("https://hoodwinked.onrender.com/start/",{method:"POST",body:JSON.stringify({name:e,killer:t})}),o=await n.json();return await o}catch(s){console.error(s)}}let p=s.createContext(),g=s.createContext(),w={gameCount:0,game_id:null,playerName:"",killer:!1,history:"",next_request:null,waiting:!1};var v=function(){let[e,t]=(0,s.useState)(!1),[n,a]=(0,s.useState)(w);async function i(e,t){a({...w,playerName:e,killer:t,gameCount:n.gameCount+1,waiting:!0});let o=await y(e,t);a({...n,...o,waiting:!1})}return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(f(),{children:[(0,o.jsx)("title",{children:"Hoodwinked"}),(0,o.jsx)("meta",{name:"description",content:"AI Deception Game"}),(0,o.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"})]}),(0,o.jsx)("div",{children:(0,o.jsx)(g.Provider,{value:[n,a],children:(0,o.jsxs)(p.Provider,{value:[e,t],children:[(0,o.jsx)(r,{}),(0,o.jsx)(d,{startGame:i}),e&&(0,o.jsx)(m,{startGame:i})]})})})]})}},679:function(e){e.exports={window:"chat_window__RUbuH",history:"chat_history__KoBaL",input:"chat_input__CDuVg"}},6722:function(e){e.exports={login:"login_login___x1HT",loginOverlay:"login_loginOverlay__Le1hQ"}},8884:function(e){e.exports={sidebar:"sidebar_sidebar__1af5q",h1:"sidebar_h1__O_RQy",h3:"sidebar_h3__j38aG",option:"sidebar_option__0MAno",play:"sidebar_play__fhY3a",info:"sidebar_info__h4MHL"}},9008:function(e,t,n){e.exports=n(3121)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=5728)}),_N_E=e.O()}]);